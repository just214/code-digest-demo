name: Generate Code Digest

on:
  push:
    branches:
      - main # Adjust the branch(es) as needed

jobs:
  generate-digest:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Checkout External Repo
        uses: actions/checkout@v3
        with:
          repository: Nowayz/CodeDigest # Replace with the external repo name
          path: code-digest # Directory to clone the external repo into

      - name: Set Up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18" # Using a recent LTS version

      - name: Make script executable
        run: chmod +x ./code-digest/codedigest.js

      - name: Generate Code Digest
        run: node ./code-digest/codedigest.js --output digest.txt

      - name: Upload Digest as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: code-digest
          path: digest.txt
